import random
import sys
from math import sqrt

from common import *
from rsa import *
from elgamal import *
from attacks import *


def main():
    # consider changing it to test stability
    random.seed(1)

    #########################################################################################################################
    # RSA                                                                                                             #
    #########################################################################################################################
    print("test RSA")
    print()

    ####################
    # Q12
    ####################
    e, d, n = gen_rsa(512)
    m = "ceci est le message de la question"
    c = RSAcipher(e, n, m)
    print("Public key e :", e)  # 89712750945950099826785509953455571483613503173432547137325765528934460732110532311194722731571513976828981638535843969383527475665891275888291396498782868356002863396447000223039554999748131204865356482916305442543336472668504302022914205826777478862620263579983605406774951532578128568404799585978042214351
    print("Public key n :", n)  # 97349606654872955583192686280263401977569233022038062247012777979271203605614410276442822429812271761473194975741592047032220155855328818355025479071486176260885575927381806319083871011168460525989838983969101645052108446985024617365904928782501105555099054015934319685985267816643971883634810763480683010267

    print("Secret key :", d)  # 76671292008890767395635699395744390106258811619663976198758120416387060158509173292801389770018191432962560967490154971987206782432919329087924323809105969540096781372900022282872396903848052933089749959114129317034672097222288177673531405984410691180739772450639019207084496076328804324212916498744046485103

    print("Encrypted message :", c)  # 17558098987687777730838231528469764810612383819913794112229608050395553274100088213814685828555374391171475841869269723260268133614959680598248186031964749391244802273383500796851188584441734653234049048601707034273402822695108573023257641219848937968322010477718972651291997338760261064531726220624745484963


    ####################
    # Q13
    ####################

    # signez et verifiez le message m
    # utilisez la meme signature sur un autre message et montrez que la signature est invalide

    #########################################################################################################################
    # ELGAMAL                                                                                                             #
    #########################################################################################################################
    print("test elgamal")
    print()

    ####################
    # Q18
    ####################

    # A envoie les messages m1 et m2
    # indiquez les appels de A, B, et leurs echanges de cles

    m1 = "test1"
    m2 = "test2"

    #bob ou alice
    p,g=gen_elgamal_pg(20)
    #bob
    bob_sk,bob_pk=gen_elgamal_sk_Ephemeral(p, g)
    #alice
    al_sk,al_pk=gen_elgamal_sk_Ephemeral(p, g)
    #alice
    al_secret=caluclate_secret_alice(bob_pk, al_sk, p)
    #bob
    bob_secret=caluclate_secret_bob(al_pk, bob_sk, p)
    #alice
    c1=enc_secret(m1, al_secret, p)
    #alice
    c2=enc_secret(m2, al_secret, p)
    #bob
    mr1=dec_secret(c1,bob_secret,p)
    #bob
    mr2=dec_secret(c2,bob_secret,p)
    print(mr1,mr2)

    #########################################################################################################################
    # Attacks                                                                                                             #
    #########################################################################################################################
    print("test attacks")
    print()

    ####################
    # Q20
    ####################

    p = 13149167286035228681208048243723737375090888001598751312750995025253986460692475192394609296094307081001995933500803068311525441644804326013910743968349067
    g = 3
    ke = 5779558425899722829462032068886306776597585752530520948534653785137060735047309719455813204986916364802382483053171126268204319822019211031230222070723090
    m1 = "It's time to kick ass"
    c1 = 12827344781818296194928684071422994190775950385951166563395502007269543223985244757036918449083054349576709624381976573093843142486261827657493216618073997
    c2 = 4331791743119332127373379050749207468532256906451531321580452205843713552890298549897050959745979703750115529447731078240184592325689871764781475176716496

    ####################
    # Q21
    ####################

    c = 469240621441239
    e = 168740015896667
    n = 854208139957651

    ####################
    # Q22
    ####################

    e1 = 43043119187279639173790958142026052971203536684547441517028705031836944442061199675145980400482365682358509201781646515907501840350973641109660740023317856690683915670567911298739607671973892901327381391181473203651413637912944820557452960516718965698630341431388427259699912741371546245435604538538230119579
    N1 = 104145149002860465307088860704451258613506057954338292745541281092743178431288403998663030924161116444537748121649486304482540038841063808103407602865986084594209686251269252938757301197228518782448947255071707844317955098411108723333480504515713987202100066543853274418787506078555046641796447551623975547341
    c = 30612069577105697454394686057574694668767298151106845481338092177831646031094618836734278988218307915054595975820207907819248992687541447702254235430840609971532689356807535733773567495614617064116293560656322398990858631945177571400653492752108914479487566036750808433168590170416733607823746215030279668036
    e2 = 134802072529959519019935225496950491874544720495386856088591724450650842848874173073295556146277645674585273946835963406599665039978789900333760727092217899356012292632867392827077899606707451115486665408905046660065875272112175469085610767644641715510738849860160043476246123765073533058132631497334415570371
    N2 = 164516970546873332079448835406101389551039252641604498951665406176254977859169167504323855229296985734340062818091840249978684651868746194390219362029274943931131639266630866810905399918613028316760373204028391873652489017206168507003288950469102483816639647600459518413253357064167789339439108927609048879571

    ####################
    # Q23
    ####################

    e = 3
    N1 = 8644661035510993313730416795705161801699691739641405806059159254659891130920452848886650609345208624570983897009951468876944915100290923946838530627540117
    c1 = 833563997838922007703276228697799653818564478541
    N2 = 6615046562661980306487056407055889554387954577227788720593864060059226671793480675287327187195309141646250023211695853203471566149974116729820142667983731
    c2 = 833563997838922007703276228697799653818564478541
    N3 = 6455036181967193254263190296345787563992878094627870828617555941189593243509606163763404014825646619246025607641830552437184513176976320907563205370481329
    c3 = 833563997838922007703276228697799653818564478541

    ####################
    # Q24 - bons
    ####################

    e1 = 335005463960816278593867316896417983166152916344794573850343153194217911312049872711136325234993418003668720236803986830311580268508550980361654685346311
    N1 = 5091051477963388231001637916796944302688369871753703137277176206069939465618876740391747924500711710028638413264341759139522270049313860235633263862054043
    c1 = 4145467078845472644712994806773571070731259201297400785818159271701026566350697311159454042538512643215451570946380981445723923315865474776196912541298967

    e2 = 3880522386929786816439757650057726253188135798562155960090443809425982789187841739707198985802185440418350010118211685642720469665257056875247463135661403
    d2 = 2270270259341137360152942794271619370360758459724185928285877626378514257525937090103380531321958458730253721937068263828249543225253424826884975859409347
    N2 = 5091051477963388231001637916796944302688369871753703137277176206069939465618876740391747924500711710028638413264341759139522270049313860235633263862054043


main()
